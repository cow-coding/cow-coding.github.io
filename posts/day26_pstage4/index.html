<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4" /><meta property="og:locale" content="en" /><meta name="description" content="P Stage 1 : Project Day 4" /><meta property="og:description" content="P Stage 1 : Project Day 4" /><link rel="canonical" href="https://cow-coding.github.io/posts/day26_pstage4/" /><meta property="og:url" content="https://cow-coding.github.io/posts/day26_pstage4/" /><meta property="og:site_name" content="Coding Gallery" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-24T22:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="TXb5nWUV5Ag0O8EVGMTUS11ZVi7BYOensPMiRdQGNRg" /> <script type="application/ld+json"> {"description":"P Stage 1 : Project Day 4","url":"https://cow-coding.github.io/posts/day26_pstage4/","@type":"BlogPosting","headline":"[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4","dateModified":"2022-03-22T04:02:07+09:00","datePublished":"2022-02-24T22:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cow-coding.github.io/posts/day26_pstage4/"},"@context":"https://schema.org"}</script><title>[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4 | Coding Gallery</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Coding Gallery"><meta name="application-name" content="Coding Gallery"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4761810170892865" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/my_img/icebear.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Coding Gallery</a></div><div class="site-subtitle font-italic">마침표를 찍고 조금 더 멀리</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/cow-coding" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['kbp0237','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/cow-coding">Park Kibum</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-02-24 22:00:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Thu, Feb 24, 2022, 10:00 PM +0900" >Feb 24, 2022</em> </span> <span> Updated <em class="timeago" date="2022-03-22 04:02:07 +0900 " data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 22, 2022, 4:02 AM +0900" >Mar 22, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1453 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h1 id="p-stage-1--project-day-4">P Stage 1 : Project Day 4</h1><hr /><h2 id="day-4-list">Day 4 list <a href="#day-4-list" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>wandb 연결<li>train - validation 분리<li>pre transform 적용으로 데이터 로더 속도 증가<li>SENet 사용<li>Multi-head classifier 구현<li>CutMix 적용</ol><hr /><h2 id="wandb-연결">wandb 연결 <a href="#wandb-연결" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/image/boostcamp/pstage/img_classify/wandb.png" alt="" data-proofer-ignore></p><p>CLI 창에 뜨는 값으로만 확인하기엔…. 너무 힘들기도 하고 영 눈에 안들어오는 거 같아서 wandb에 연결했습니다. 생각보다 어렵지 않았습니다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">wandb</span> <span class="o">==</span> <span class="s">"true"</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
        <span class="n">wandb</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s">"project"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">cofing</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="s">"entity"</span><span class="p">)</span>

    <span class="p">...</span>

    <span class="c1"># validation part
</span>    <span class="p">...</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">wandb</span> <span class="o">==</span> <span class="s">"true"</span><span class="p">:</span>
        <span class="n">wandb</span><span class="p">.</span><span class="n">log</span><span class="p">({</span><span class="s">"Loss"</span><span class="p">:</span> <span class="p">{</span><span class="s">"train loss"</span><span class="p">:</span> <span class="n">train_loss</span><span class="p">,</span> <span class="s">"val loss"</span><span class="p">:</span> <span class="n">val_loss</span><span class="p">},</span><span class="s">"F1 Score"</span><span class="p">:</span> <span class="p">{</span><span class="s">"train f1"</span><span class="p">:</span> <span class="n">train_f1</span><span class="p">,</span> <span class="s">"val f1"</span><span class="p">:</span> <span class="n">val_f1</span><span class="p">}})</span>
</pre></table></code></div></div><p>위처럼 코드 작성했고 물론 1에포크당 validation check를 하므로 1에포크의 평균치로 기록됩니다. <code class="language-plaintext highlighter-rouge">wandb.init</code>에 들어가는 <code class="language-plaintext highlighter-rouge">name</code>은 사용자 입력으로 받는 모델 이름으로 넘겨주어서 wandb 사이트에서 어떤 모델이 어떤 지표를 나타내는지 보기 쉽게하였습니다.</p><hr /><h2 id="train-valid-분리">train-valid 분리 <a href="#train-valid-분리" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>이번 대회에서는 이미지에 대한 데이터프레임을 만들고 <code class="language-plaintext highlighter-rouge">sklearn</code>의 <code class="language-plaintext highlighter-rouge">train_test_split</code>을 쓰면 안되는 구조로 되어있습니다. 일반적으로 validation check를 위해서 데이터 스플릿을 진행하는데, 데이터가 1명에 대해 다양한 클래스로 나눠져있어서 사람별로 스플릿하지 않으면 validation check 과정에서 cheating이 발생합니다.</p><p><img data-src="/image/boostcamp/pstage/img_classify/split.png" alt="" data-proofer-ignore></p><p>따라서 train과 valid를 일단 사람별로 인덱스로 구분하고 그 인덱스를 <code class="language-plaintext highlighter-rouge">Dataset</code>에 넘겨주어 처리하는 방식을 선택했습니다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">CustomTrainDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pre_transforms</span><span class="p">:</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transforms</span><span class="p">:</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">train</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s">'/opt/ml'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">img_url</span> <span class="o">=</span> <span class="s">'/input/data/train/images'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__make_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">df</span><span class="p">[</span><span class="s">'path'</span><span class="p">].</span><span class="n">values</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pre_transforms</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">pre_transforms</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">images</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__make_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">train</span><span class="p">:</span>
            <span class="n">save_name</span> <span class="o">=</span> <span class="s">'train_df.csv'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_name</span> <span class="o">=</span> <span class="s">'valid_df.csv'</span>
        <span class="n">ret_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'gender'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">,</span> <span class="s">'age_group'</span><span class="p">,</span> <span class="s">'mask'</span><span class="p">,</span> <span class="s">'path'</span><span class="p">,</span> <span class="s">'class'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">save_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'/opt/ml/outputs'</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"File </span><span class="si">{</span><span class="n">save_name</span><span class="si">}</span><span class="s"> is Exist!"</span><span class="p">)</span>
            <span class="n">ret_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'/opt/ml/outputs/'</span><span class="o">+</span><span class="n">save_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">:</span>
                <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">base_url</span><span class="o">+</span><span class="s">'/'</span><span class="o">+</span><span class="bp">self</span><span class="p">.</span><span class="n">img_url</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">path</span><span class="p">))):</span>
                    <span class="c1"># 보안상 생략
</span>                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="c1"># 보안상 생략
</span>                        <span class="p">}</span>
                        <span class="n">ret_df</span> <span class="o">=</span> <span class="n">ret_df</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ret_df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'/opt/ml/outputs/'</span><span class="o">+</span><span class="n">save_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret_df</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">classes</span><span class="p">[</span><span class="s">'class'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">df</span><span class="p">)</span>
</pre></table></code></div></div><p>위 방식처럼 특정 데이터프레임을 받아오면 그 데이터프레임에 대해 처리를 전반적으로 진행합니다. 물론 데이터셋을 생성하는 과정에서 오래 걸리는 것이 문제라 이 부분을 해결하기위해 제공된 베이스라인을 분석 및 변형할 예정입니다.</p><p>–</p><h2 id="pre-transform">pre transform <a href="#pre-transform" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>전반적인 학습속도가 너무 오래 걸리는 것이 문제였습니다. 이유는 <code class="language-plaintext highlighter-rouge">DataLoader</code>가 배치 1개를 불러올때 속도가 오래 걸리는 것이 문제였습니다. 따라서 전반적인 학습 속도의 향상을 위해 GPU 메모리의 사용률을 높이는 방향으로 갔습니다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">pre_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">.</span><span class="n">Compose</span><span class="p">([</span>
        <span class="n">transforms</span><span class="p">.</span><span class="n">Resize</span><span class="p">((</span><span class="mi">512</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="mi">384</span><span class="o">//</span><span class="mi">4</span><span class="p">)),</span>
    <span class="p">])</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">CustomTrainDataset</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">pre_transforms</span><span class="o">=</span><span class="n">pre_transform</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p>이렇게 pre_transform을 통해 이미지의 전체 비율을 줄입니다. 이 과정을 거치면 1개의 이미지 용량이 줄어들게 됩니다. 그리고 <code class="language-plaintext highlighter-rouge">pre_transform</code>이 적용되는 과정을 보면 다음과 같습니다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">CustomTrainDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pre_transforms</span><span class="p">:</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transforms</span><span class="p">:</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">train</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s">'/opt/ml'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">img_url</span> <span class="o">=</span> <span class="s">'/input/data/train/images'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__make_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">df</span><span class="p">[</span><span class="s">'path'</span><span class="p">].</span><span class="n">values</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pre_transforms</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">pre_transforms</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">images</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    
    <span class="p">...</span>
</pre></table></code></div></div><p>데이터셋을 구성할 때 모든 이미지를 불러와서 메모리에 올리는 방식을 사용했습니다. 이 방법을 사용하면 데이터셋 구성에서 시간이 오래 걸리지만 1번의 과정만 시간을 소모하면 되므로 학습 시간에서 향상이 나타났습니다. 하지만 이 자체가 그렇게 좋은 것은 아니라 생각되므로 추가적인 방법을 고려해서 데이터셋 로드 시간 자체도 줄여야겠습니다.</p><hr /><h2 id="senet-사용-multi-head-classifier-구현">SENet 사용, Multi-head classifier 구현 <a href="#senet-사용-multi-head-classifier-구현" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>일단 이미지 분류 대회다보니 ILSVRC에서 우승한 모델들 위주로 찾아봤습니다. 그 중 SENet이 성능이 좋은 것으로 나타났단 것을 보고 관련 내용 구현코드를 활용했습니다.<br /> 자세한 코드 설명은 하지 않겠습니다. 일단 <code class="language-plaintext highlighter-rouge">torchvision</code>의 <code class="language-plaintext highlighter-rouge">resnet18</code>보다 성능이 좋지 않기 때문에 이를 그대로 사용할 것입니다.</p><p>마찬가지로 어제 구상한 multi-head classifier를 구현해봤습니다. 기존 resnet의 out_feature 1000을 유지하고 1000에다가 마지막에 총 3개의 <code class="language-plaintext highlighter-rouge">nn.Linear</code>를 추가했습니다. 이를 총 18개의 클래스 위치에 값을 연산하여 <code class="language-plaintext highlighter-rouge">forward</code> 처리를 해주는 모델을 구상했습니다. 이 코드도 딱히 의미가 있지 않아서 첨부하진 않겠습니다.<br /> 이후 공개되는 깃허브로 공유하겠습니다.</p><p>성능 향상은 크게 없었습니다.</p><hr /><h2 id="cutmix">CutMix <a href="#cutmix" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>data augmentation 방법 중 cut mix가 효과가 좋다고 알고 있습니다. 해당 값을 적용했더니 validation loss가 많이 줄어드는 것을 발견했으나 정작 test data에서 좋은 성능이 나타나지 않습니다….</p><p>진짜 모르겠습니다 ㅠㅠㅠㅠㅠㅠㅠㅠㅠ 내일 팀원들이랑 상의를 해봐야겠습니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/naver-boostcamp-ai-tech/'>NAVER BoostCamp AI Tech</a>, <a href='/categories/p-stage/'>P Stage</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/deep-learning/" class="post-tag no-text-decoration" >Deep Learning</a> <a href="/tags/naver/" class="post-tag no-text-decoration" >NAVER</a> <a href="/tags/boostcamp/" class="post-tag no-text-decoration" >BoostCamp</a> <a href="/tags/ai-tech/" class="post-tag no-text-decoration" >AI Tech</a> <a href="/tags/image-classification/" class="post-tag no-text-decoration" >Image Classification</a> <a href="/tags/project/" class="post-tag no-text-decoration" >Project</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4 - Coding Gallery&url=https://cow-coding.github.io/posts/day26_pstage4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4 - Coding Gallery&u=https://cow-coding.github.io/posts/day26_pstage4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[BoostCamp AI Tech / P Stage 1] Day26 - Project Day 4 - Coding Gallery&url=https://cow-coding.github.io/posts/day26_pstage4/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/coursera2_3/">[MLOps Specialization / Step2] Labeling Data</a><li><a href="/posts/module/">[BoostCamp AI Tech / 심화포스팅] torch.nn.Module 뜯어먹기</a><li><a href="/posts/list/">[Deep Dive Python] 2. List</a><li><a href="/posts/variable/">[Deep Dive Python] 1. Python의 객체와 변수 개념</a><li><a href="/posts/final7/">[BoostCamp AI Tech / Final] Day91 - Airflow setting 및 배치 파이프라인 설계</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ai-tech/">AI Tech</a> <a class="post-tag" href="/tags/boostcamp/">BoostCamp</a> <a class="post-tag" href="/tags/naver/">NAVER</a> <a class="post-tag" href="/tags/deep-learning/">Deep Learning</a> <a class="post-tag" href="/tags/mlops/">MLOps</a> <a class="post-tag" href="/tags/data-engineering/">Data Engineering</a> <a class="post-tag" href="/tags/project/">Project</a> <a class="post-tag" href="/tags/basic/">Basic</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/recommender-system/">Recommender System</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/day23_pstage1/"><div class="card-body"> <em class="timeago small" date="2022-02-21 19:00:00 +0900" >Feb 21, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[BoostCamp AI Tech / P Stage 1] Day23 - Project Day 1</h3><div class="text-muted small"><p> P Stage 1 : Project Day 1 Day 1 list 대회 데이터 EDA pre-trained model인 ResNet18 기준 베이스라인 전체 코드 작성 데이터 EDA 요약 지금 이거 작성을 첫날에 못해서 3일째에 작성중인데 up vote 짱 많음~ 추가적인 EDA 요소 찾아보면 좋을듯 게시글 to...</p></div></div></a></div><div class="card"> <a href="/posts/day24_pstage2/"><div class="card-body"> <em class="timeago small" date="2022-02-22 19:00:00 +0900" >Feb 22, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[BoostCamp AI Tech / P Stage 1] Day24 - Project Day 2</h3><div class="text-muted small"><p> P Stage 1 : Project Day 2 Day 2 list 깃허브 README 실험기록 자동화 코드 수행 F1Score scoring 코드 추가 baseline model 기본 하이퍼파라미터 제출 깃허브 README 자동화 요약 부캠에서 제공해준 팀 프로젝트용 깃허브에 각자 폴더를 만들어서 실험 진행하기로 함...</p></div></div></a></div><div class="card"> <a href="/posts/day25_pstage3/"><div class="card-body"> <em class="timeago small" date="2022-02-23 22:00:00 +0900" >Feb 23, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[BoostCamp AI Tech / P Stage 1] Day25 - Project Day 3</h3><div class="text-muted small"><p> P Stage 1 : Project Day 3 Day 3 list 신규 모델 구상 신규 모델 아이디어 구상 요약 ResNet18 기준 0.5정도 나옴 성능 올리고자 data augmentation 이전에 모델 구성적 접근 구상 자세한 구상은 자세한 이야기에… 자세한 이야기 일단 이번 대회의 목표는 총 18개의 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/day25/" class="btn btn-outline-primary" prompt="Older"><p>[BoostCamp AI Tech] Day25</p></a> <a href="/posts/day26/" class="btn btn-outline-primary" prompt="Newer"><p>[BoostCamp AI Tech] Day26</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://cow-coding.github.io/posts/day26_pstage4/'; this.page.identifier = '/posts/day26_pstage4/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://cow-coding.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/cow-coding">Park Kibum</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ai-tech/">AI Tech</a> <a class="post-tag" href="/tags/boostcamp/">BoostCamp</a> <a class="post-tag" href="/tags/naver/">NAVER</a> <a class="post-tag" href="/tags/deep-learning/">Deep Learning</a> <a class="post-tag" href="/tags/mlops/">MLOps</a> <a class="post-tag" href="/tags/data-engineering/">Data Engineering</a> <a class="post-tag" href="/tags/project/">Project</a> <a class="post-tag" href="/tags/basic/">Basic</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/recommender-system/">Recommender System</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { loader: {load: ['[tex]/color']}, chtml: { scale: 1.2 }, tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ], packages: {'[+]':['color']} } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-163727422-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-163727422-1'); }); </script>
